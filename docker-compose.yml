version: '3.5'

services:
  tmweb:
    image: httpd:alpine
    restart: unless-stopped
    network_mode: host
    depends_on:
      - tmapp
    volumes:
      - "./transmart-web/httpd-vhosts.conf:/usr/local/apache2/conf/extra/httpd-vhosts.conf"
      - "./transmart-web/httpd.conf:/usr/local/apache2/conf/httpd.conf"
  tmapp:
    image: transmartfoundation/transmart-app:latest
    restart: unless-stopped
    ports:
      - "127.0.0.1:8009:8009"
    depends_on:
      - tmdb
      - tmsolr
    volumes:
      - "./transmart-app/Config.groovy:/var/lib/tomcat8/.grails/transmartConfig/Config.groovy"
      - "./transmart-app/DataSource.groovy:/var/lib/tomcat8/.grails/transmartConfig/DataSource.groovy"
      - "./transmart-app/setenv.sh:/usr/share/tomcat8/bin/setenv.sh"
      - "appdata:/root/.grails"
      - "apptmp:/tmp"
      - "appwebapps:/usr/local/tomcat8/webapps"
  tmdb:
    image: transmartfoundation/transmart-db:latest
    restart: unless-stopped
    ports:
      - "127.0.0.1:5432:5432"
    volumes:
      - "postgresdata:/var/lib/postgresql"
      - "postgreslogs:/var/log/postgresql"
  tmsolr:
    image: transmartfoundation/transmart-solr:latest
    restart: unless-stopped
  tmrserve:
    image: transmartfoundation/transmart-rserve:latest
    restart: unless-stopped
    volumes:
      - "apptmp:/tmp"
      - "appwebapps:/usr/local/tomcat8/webapps"
  tmload:
    image: transmartfoundation/transmart-load:latest
    depends_on:
      - tmdb

volumes:
  appdata:
  apptmp:
  appwebapps:
  postgresdata:
  postgreslogs:
