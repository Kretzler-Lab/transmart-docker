filter {
  if [type] == 'apache2_access' {
    grok {
      match => { "message" => "%{COMBINEDAPACHELOG} - %{NUMBER:duration}" }
    }
    date {
      match => [ "timestamp" , "dd/MMM/yyyy:HH:mm:ss Z" ]
    }
    geoip {
      source => "clientip"
      target => "geoip"
      database => "/etc/logstash/GeoLiteCity.dat"
      add_field => { "[geoip][coordinates]" => "%{[geoip][longitude]}" }
      add_field => { "[geoip][coordinates]" => "%{[geoip][latitude]}"  }
    }
    mutate {
      convert => {
        "[geoip][coordinates]" => "float"
        "duration" => "integer"
        "bytes" => "integer"
      }
    }
    if [request] =~ "transmart" {
      grok {
        match => {"request" => "/transmart/%{DATA:tmendpoint}/.*"}
      }
    }
  }
}
